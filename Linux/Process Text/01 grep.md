# Grep
> document: https://www.gnu.org/software/grep/manual/grep.html

## 1. 介绍
> 给定一个或多个模式，**grep**在输入文件中搜索与这些模式匹配的内容。当它在一行中发现匹配项，它默认情况下将匹配项拷贝到标准输入输出，或者使用选项生成您的请求的任何其他类型的输出。  
> **Grep**没有对文本的长度做出任何限制，只要文本的大小不超出内存的限制，并且它可以匹配一行中的任意字符。如果输入文本的最后一个字节不是一个新行，**grep**将会自动补充一个换行符。由于换行符也是模式列表的分隔符，因此无法匹配文本中的换行符。

## 2. 调用
``` shell
grep [option ...] [patterns] [file...]
```
> 使用**grep**的时候可以输入零个或多个option参数，零个或多个file参数。patterns参数要求一个或多个由换行符分隔的模式，当通过"-e patterns"或"-f file"选项提供模式时，该参数将被省略。在shell命令中使用**grep**时，通常引用该模式。

### 2.1 命令行选项
> **Grep**拥有一系列丰富的选项：一些来源于**POSIX**，另一部分来源于**GNU**拓展。长选项名的总是来源于**GNU**拓展，即使对于来自**POSIX**规范的选项也是如此。**POSIX**在其短名称下指定的选项被明确标记为便于**POSIX**可移植编程。提供了一些选项名称以与较旧或更奇特的实现兼容。  
  
#### 2.1.1 通用程序信息
> --help  
> 打印一条使用消息，简要总结命令行选项和错误报告地址，然后退出。

> -V | --version  
> 将**grep**的版本号打印到标准输入输出流。此版本号应该包含在所有的错误报告中。

#### 2.1.2 匹配控制
> -e *patterns*  
> --regexp=*patterns*  
> pattens中的换行符将多个pattern分隔开。如果此选项被多次使用或者与 **-f(--file)** 选项组合使用，将搜索给定的所有模式。在**shell**命令中使用**grep**，通常应该引用该模式。（**-e**由**POSIX**指定。）
![alt 匹配控制-e参数](../img/常用命令/01%20grep/grep_e.png)

> -f file  
> --file=*file*  
> 从文件中按行提取匹配的文本。如果此选项被多次使用或与 **-e(--regrep)** 选项组合使用，将搜索给定的所有模式。当文件为"-"时，将从标准输入输出读取输入文本。空文件包含零个模式，因此不匹配任何模式。(**-f**由**POSIX**指定。)  
> 注：应该注意的是，这个模式并非指定要搜索的文本，而是指定存储了pattern的文本！
![alt 匹配控制-f参数](../img/常用命令/01%20grep/grep_f.png)

> -i  
> -y  
> --ignore-case  
> 忽略模式和输入数据的大小写区别，使大小写不同的字符相互匹配。  
![alt 匹配控制-i参数](../img/常用命令/01%20grep/grep_e.png)

> --no-ignore-case  
> [默认选项]区分模式和输入数据的大小写区别。

> -v  
> --invert-match  
> 反转匹配结果，显示没有匹配的行(**-v**由**POSIX**指定。)  
![alt 匹配控制-v参数](../img/常用命令/01%20grep/grep_v.png)

> -w  
> --word-regexp  
> 选取那些整个单词匹配模式的行。文本的开头必须匹配模式，除非文本的开头以非**word**组成的字符。同样，文本的结尾也要满足上述要求。**Word**组成在**grep**中包含*字母*、*数字*和*下划线*。  
> 当命令中同时指定参数 **-x** 的时候，**-w** 参数将会失效。  
> 由于，**-w** 选项可以匹配不以**word**成分开头和结尾的子字符串，因此它不同于用"\<"和">"包围的正则表达式。  
> 注：也就是说，可以使用 **-w** 参数匹配到"@"等非 **word** 字符，但是无法用"\<"和">"包围的正则表达式匹配非 **word** 字符。  
![alt 匹配控制-w参数](../img/常用命令/01%20grep/grep_w.png)

> -x  
> --line-regexp  
> 只选择与整行完全匹配的匹配项。对于正则表达式模式，这就像将每个模式用括号括起来，然后用“^”和“$”包围它。（-x由POSIX指定。）   
![alt 匹配控制-x参数](../img/常用命令/01%20grep/grep_x.png)

#### 2.1.3 通用输出控制
> -c   
> --count   
> 取消常见的匹配文本输出，替代为输出每个输入文件匹配的行数。当结合 **-v** 参数使用时，输出未匹配的行数。  
![alt 通用输出控制-c参数](./../img/常用命令/01%20grep/grep_c.png)

> --color[=*WHEN*]  
> --colour[=*WHEN*]  
> 用于指定匹配的文本是否显示颜色。若要改变匹配文本显示的颜色，可以使用*GREP_COLORS*环境变量。  
> 例如： ** export GREP_COLORS='ms=01;31' **  
![alt 通用输出控制--color参数](./../img/常用命令/01%20grep/grep_color.png)

> -L  
> --files-without-match  
> 输出没有任何行匹配模式的文件名。  

> -l  
> --files-with-matchs  
> 输出所有能够匹配模式的文件名。该参数下，当**grep**在同一文件中找到第一个匹配项后就会立即停止后续的匹配工作。  
![alt 通用控制输出-L参数](./../img/常用命令/01%20grep/grep_L.png)

> -m *num*  
> --max-count=*num*  
> 当匹配的行数等于*num*时，**grep**将立即停止。若*num*=0，则**grep**不会读取输入文本，立即退出；若*num*=-1，则代表数量无限多，**grep**在遍历完输入文本之前，不会因为匹配的行数的数量而停止，这也是默认选项。  
> 如果输入是常规文件的标准输入，并且输出*num*个选定行，则**grep**确保标准输入位于推出前最后一个选定行之后，而不管后面是否存在上下文行。这使得调用过程能够恢复搜索。  
> 当**grep**在选定的*num*行之后停止，它将会输出匹配的行内容。如果同时使用 **-c** 或 **--count** 选项，那输出的值将不会大于*num*。如果同时使用 **-v** 或 **--invert-match** 那么 **grep** 将会在寻找到最多*num*个不匹配行后停止。  
![alt 通用控制输出-m参数](./../img/常用命令/01%20grep/grep_m.png)

> -o  
> --only-matching  
> 只打印匹配行中匹配的非空部分，每个部分都在单独的输出行上。输出行使用与输入相同的分隔符，如果还使用了-z（--null data），则分隔符为null字节。  
![alt 通用控制输出-o参数](./../img/常用命令/01%20grep/grep_o.png)

> -q  
> --quiet  
> --silent  
> Quiet! 不会向标准输出写入任何内容。

> -s  
> --no-messages  
> 禁止显示有关不存在或不可读文件的错误消息。

#### 2.1.3 输出行前缀控制
> 当要输出多个前缀字段时，顺序始终是文件名、行号和字节偏移量，而与指定这些选项的顺序无关。  

> -b  
> --byte-offset  
> 在输出的每一行之前，打印输入文件中基于0的字节偏移量。如果指定了-o（--仅匹配），则打印匹配零件本身的偏移量。  

> -H  
> --with-filename  
> 输出文本所在的文件名，当输入文件数量>1时，默认采用该模式。  

> -h  
> --no-filename  
> 不输出文本所在的文件名，当输入文件数量=1时，默认采用该模式。

> -n  
> --line-number  
> 输出匹配文本在文件中的行号。

> --label=*LABEL*  
> 将实际来自标准输入的输入显示为来自文件LABEL的输入。这对于在搜索之前转换文件内容的命令非常有用。

> -T  
> --initial-tab  
> 确保实际行内容的第一个字符位于制表位上，以便制表符的对齐看起来正常。这对于将输出前缀为实际内容的选项非常有用：-H、-n和-b。这也可以在输出行号和字节偏移量前加上空格，以便单个文件中的行都从同一列开始。  

> -Z  
> --null  
> 输出一个零字节（ASCII NUL字符），而不是通常跟在文件名后面的字符。例如，'grep-lZ'在每个文件名后输出一个零字节，而不是通常的换行符。此选项使输出变得明确，即使在文件名中包含换行符等不寻常字符的情况下也是如此。此选项可以与“find-print0”、“perl-0”、“sort-z”和“xargs-0”等命令一起使用，以处理任意文件名，甚至是包含换行符的文件名。

![alt 输出行前缀](./../img/常用命令/01%20grep/grep_output.png)

#### 2.1.5 关联行控制
> 关联行是没有匹配模式，并且在匹配行附近的内容。它们仅在下列的参数之一使用的时候才会输出。无论如何设置这些选项，**grep**确保不会多次输出同一行文本。如果 **-o(--only-matching)** 选项同时使用，下列的选项将不会生效，并且会进行警告提示。

> -A *num*  
> --after-context=*num*  
> 同时输出匹配行后面的*num*行。 

> -B *num*  
> --before-context=*num*  
> 同时输出匹配行前面的*num*行。  

> -C *num*  
> --context=*num*  
> 同时输出匹配行的前面*num*行和后面的*num*行。  

+ 匹配行通常使用“：”作为前缀字段和实际行内容之间的分隔符。
+ 上下文（即不匹配）行使用“-”。
+ 当没有指定上下文时，匹配的行只是一个接一个地输出。
+ 当指定上下文时，输入中相邻的行形成一个组，并一个接一个地输出，而默认情况下，在不相邻的组之间会出现分隔符。
+ 默认分隔符为“--”行；其存在和外观可以通过上述选项进行更改。
+ 当两个相邻的组彼此足够接近时，每个组可以包含多条匹配线，从而使两个相邻组连接并可以合并为一个连续的组。

![alt 关联行输出](./../img/常用命令/01%20grep/grep_context.png)

#### 2.1.6 文件和文件夹选项

> 略

#### 2.1.7 其他选项

> 略

### 2.2 环境变量

> 略

### 2.3 退出状态
> 通常，如果选择了一行，则退出状态为0；如果没有选择任何行，则为1；如果发生错误，则为2。但是，如果使用-q或-quiet或--silent选项并选择了一行，则即使发生错误，退出状态也为0。其他grep实现可能在出现错误时退出，状态大于2。

### 2.4 **Grep** 程序

> **Grep** 在给定的文件中搜索包含给定模式匹配的行。默认情况下，**grep** 输出匹配的行。

> -G  
> --basic-regexp  
> 将模式解释为基本正则表达式（BRE）。这是默认设置。

> -E  
> --extended-regexp  
> 将模式解释为扩展正则表达式（ERE）。（-E由POSIX指定。）

> -F  
> --fixed-strings  
> 将模式解释为固定字符串，而不是正则表达式。（-F由POSIX指定。）

> -P  
> --perl-regexp  
> 将模式解释为Perl兼容的正则表达式（PCRE）。PCRE支持将继续存在，但当与-z（--null data）选项结合使用时，请将此选项视为实验性选项，并注意“grep-P”可能会警告未实现的功能。请参见其他选项。

## 3. 正则匹配

> 正则匹配是一系列字符串描述的规则。**Grep** 支持3中正则表达式语法：BRE、ERE和PCRE。在GNU版本的**grep**中，BRE和ERE版本的区别仅仅是符号的不同。在其他实现中，基本正则表达式的功能正常不如拓展正则表达式，虽然偶尔也会有例外。接下来的描述针对拓展正则表达式，基本正则表达式的差异将在后面补充。PCRE的内容将略去，如有需要详见官方文档。  

### 3.1 ERE
> 在正则表达式，字符：".?*+{}|()[]\^$"属于特殊字符，其他的属于普通字符。  

| 符号 | 描述 |  
|--|--|
|**.**       | 匹配任意单字符  |
| **{**      | 正则表达式后面可能需要更几个重复运算符中的一个，以"{"开头的运算符称为区间表达式|
| **?**      | 前面的字符是可选的，最多匹配1次 |
| **\***     | 前面的字符匹配0次或者多次 |
| **+**      | 前面的字符匹配1次或者多次 |
| **{n}**    | 前面的字符匹配n次 | 
| **{n,}**   | 前面的字符匹配大于等于n次 | 
| **{,m}**   | 前面的字符匹配小于等于m次 | 
| **{n, m}** | 前面的字符匹配次数在n次到m次之间（闭区间） |
| **[]**     | 表示匹配该列表中的任意单个字符 |
| **[^]**    | 表示匹配除该列表中字符以外的单个字符 |
| **[:alnum:]** | 字母数字字符集 = [0-9a-zA-Z] |
| **[:digit:]** | 数字字符集 = [0-9] |
| **[:alpha:]** | 字母字符集 = [a-zA-Z] |
| **[:lower:]** | 小写字符集 = [a-z] |
| **[:upper:]** | 大写字符集 = [A-Z] |
| **[:black:]** | 空格和Tab键 |
| **[:cntrl:]** | 控制字符 |
| **[:spack:]** | 制表符、换行符、垂直制表符、换页符、回车符和空格 |
| **\b**        | 匹配单词边缘的空字符串 |
| **\B**        | 匹配空字符串，前提是它不在单词的边缘 |
| **\<**        | 匹配单词开头的空字符串 |
| **\>**        | 匹配单词末尾的空字符串 |
| **\w**        | 等同于匹配数字、字母和下划线 |
| **\W**        | 等同于[^\w] |
| **\s**        | 匹配空格 |
| **\S**        | 匹配空格意外的字符 = [^\s] |
| **\]**        | ] |
| **\}**        | } |
| **^**         | 匹配行首 |
| **$**         | 匹配行尾 |
| **\num**      | 第num个子表达式，如果括号内的子表达式匹配多个子字符串，则反向引用引用最后一个匹配的子字符串 eg: (ab*)*\1 可以匹配ababbabb，但是不能匹配ababbab |